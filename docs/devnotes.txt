

Si la instalación es correcta se pueden listar los idiomas soportados de la siguiente manera:


```
$tesseract --list-langs
List of available languages (3):
eng
esp
osd
snum
```


Con el servidor encendido, en otra terminal se puede hacer una petición de servicio de OCR para convertir una imágen  en texto.

```
amolina@Mac:~/repo/covidminer$curl -X POST -F file="@data/notamed.pdf" http://localhost:5000/covid19
{
  "texto": "NOTA DE INGRESO.\n\nPACIENTE MASCULINO DE 63 ANOS DE EDAD, QUIEN ACUDE POR SUS PROPIOS MEDIOS SIN FAMILIAR ACOMPANANTE.\nMOTIVO DE INGRESO: DIFICULTAD RESPIRATORIA.\n\nANTECEDENTES PERSONALES PATOLOGICOS. ENFERMEDADES CRONICO-DEGENERATIVAS:REFIERE DIABETES TIPO 2 DE 20 ANOS DE EVOLUCION\nTRATADA CON METFORMINA/GILBENCLAMIDA 1 CADA 8 HORAS, HIPERTENSION ARTERIAL SISTEMICA DE 20 ANOS DE EVOLUCION\nENTRATAMIENTO CON LOSARTAN 1 TABLETA CADA 12 HORAS. QUIRURGICOS: AMIGDALECTOMIA A LOS 8 ANOS DE EDAD REALIZADA EN EL\nHOSPITAL INFANTIL DE MEXICO SIN COMPLICACIONES , CIRUGIA DE TABIQUE NASAL HACE 10 ANOS , CIRUGIA EN OIDO IZQUIERDO HACE 30\n\nANOS NO RECUERDA MOTIVO SIN EMBARGO DERIVADO DE ELLO EL PACIENTE USA APARATO AUXILIAR PARA LA AUDICION, NIEGA ALERGICOS Y\nTRANSFUSIONALES. ETILISMO POSITIVO DESDE LOS 14 ANOS DE EDAD HASTA LOS 23 ANOS CON PATRON DE CONSUMO SEMANAL HASTA LA\nEMBRIAGUEZ SUSPENDIDO HACE 10 ANOS, TABAQUISMO POSITIVO DESDE LOS 14 ANOS DE EDAD A RAZON DE 1 CAJETILLA AL DIA SUSPENDIDO\nHACE 10 ANOS. TOXICOMANIAS INTERROGADAS Y NEGADAS.\n\nANTECEDENTES INFECTO CONTAGIOSOS PACIENTE CON ANTECEDENTE DE VIAJE A QUINTANA ROO HACE 20 DIAS. PACIENTE QUE NO CUENTA CON\nVACUNA DE INFLUENZA.\n\nPADECIMIENTO ACTUAL: INICIA EL DIA 21 OE MARZO CON ATAQUE AL ESTADO GENERAL UNA SEMANA DESPUES SE AGREGO FIEBRE\n\nCUANTIFICADA DE 37 * C ASI COMO ALTERACIONES DEL GUSTO Y EL OLFATO Y DISNEA DE MEDIANOS ESFUERZOS POR LO QUE ACUDE CON\nMEDICO PARTICULAR QUIEN INDICA MUPIROCINA (DEBIDO A MORDEDURA DE PERRO DEL DIA 16 DE MARZO) Y PARACETAMOL INDICANDO\nCONFINAMIENTO DESDE EL DIA 29 DE MARZO HASTA EL DIA DE HOY QUE PRESENTA AUMENTO DE LA DISNEA MOTIVO ACUDE A ESTA UNIDAD\nHOSPITALARIA PARA SU VALORACION.\n\nALA EXPLORACION FISICA: CON LOS SIGNOS VITALES: 120/70 MMHG. FRECUENCIA CARDIACA: 109 LPM. FRECUENCIA RESPIRATORIA: 22 RPM.\n\nSAT. O2 77 %. TEMP: 36.3°C\n\nALA EXPLORACION FISICA, SE ENCUENTRA PACIENTE DESPIERTO, ORIENTADO EN TIEMPO PERSONA Y ESPACIO. FUNCIONES MENTALES SUPERIORES\nCONSERVADAS, TEGUMENTOS MODERADAMENTE DESHIDRATADOS. CRANEO: SIN PALPAR ENDOSTOSIS NI EXOSTOSIS Y SIN DETECTAR\nCREPITACIONES. APARATO AUDITIVO AUXILIAR IZQUIERDO, PUPILAS ISOCORICAS Y NORMORREFLEXICAS, ESCLEROTICAS SIN HIPEREMIA . NARINAS\nPERMEABLES, MUCOSAS ORALES DESHIDRATADAS. PUPILAS ISOCORICAS Y NORMORREFLEXICAS A ESTIMULO LUMINOSO. CUELLO INTEGRO, LARGO,\nCILINDRICO Y SIN ADENOMEGALIAS CERVICALES, SIN DATOS DE INGURGITACION YUGULAR. TORAX INTEGRO, NORMOLINEO CON AUMENTO DELOS\nMOVIMIENTOS DE AMPLEXION AMPLEXACION, HIPOVENTILADO EN EN AREAS BASALES DE FORMA BILATERAL AUSCULTANDOSE ESTERTORES FINOS,\nNO SE AUSCULTAN SIBILANCIAS, INTEGRANDO SINDROME PLEUROPULMONAR DE TIPO CONSOLIDACION. AREA CARDIACA CON RUIDOS RITMICOS\n\nY SINCRONICOS CON AUMENTO DE TONO E INTENSIDAD. ABDOMEN GLOBOSO A EXPENSAS DE PANICULO ADIPOSO, PERISTALSIS DISMINUIDA EN\nFRECUENCIA E INTENSIDAD, SIN PALPAR VISCEROMEGALIAS, PUNTOS URETRALES MEDIOS NEGATIVOS. EXTREMIDADES TORACICAS INTEGRAS Y SIN\nALTERACIONES EN SUS ARCOS DE MOVILIDAD, LLENADO CAPILAR 2 SEGUNDOS. EXTREMIDADES INFERIORES: SIN EDEMA, CON PULSOS\nPERIFERICOS PRESENTES EN BUEN TONO INTENSIDAD, CON LLENADO CAPILAR INMEDIATO Y PRESENCIA DE LESION EN PIERNA IZQUIERDA DE 4 CM\nCON SECRECION DE FIBRINA SIN DATOS DE INFECCION AL MOMENTO DELA EXPLORACION.\n\nPACIENTE DE LA SEPTIMA DECADA DE LA VIDA QUIEN CUMPLE CON DEFINICION OPERACIONAL PARA CASO SOSPECHOSO POR COVID-19,\nPRESENTANDO SATURACION DE OXIGENO AL 77% ADEMAS DE DATOS CLINICOS DE DIFICULTAD RESPIRATORIA, POR LO QUE SE DECIDE SU\nINGRESO AL SERVICIO DE URGENCIAS , PARA CONTINUAR CON PROTOCOLO DE ESTUDIO. Q-SOFA DE 1 PUNTO. NEWS-2 6 PUNTOS, LO QUE INDICA\nNECESIDAD DE MANEJO INTRAHOSPITALARIO. PACIENTE QUE PRESENTA HERIDA ANTIGUA POR MORDEDURA DE PERRO EN EXTREMIDAD PELVICA\nIZQUIERDA LIMPIA SIN DATOS DE INFECCION.\n\nSE INICIA MANEJO CON OXIGENO SUPLEMENTARIO CON BOLSA RESERVORIO ADEMAS DE SOLUCIONES CRISTALOIDES POR VIA PERIFERICA.\nOMEPRAZOL 40 MG. IV CADA 24 HRS. AZITROMICINA 500 MG. VO CADA 24 HRS. OSELTAMIVIR 75 MG, VO CADA 12 HRS. SE SOLICITAN Y SE\n\nTOMAN MUESTRAS PARA ESTUDIOS DE LABORATORIO, ASI COMO PANEL RESPIRATORIO PRUEBA PARA COVID 19 Y SE SOLICITA RADIOGRAFIA DE\nTORAX. DE IGUAL FORMA, SE LLENA FORMATO DE ESTUDIO EPIDEMIOLOGICO TANTO PARA INFLUENZA COMO PARA COVID-19. DEBIDO ALA\nSINTOMATOLOGIA DEL PACIENTE, NO SE DESCARTA MANEJO AVANZADO DE LA VIA AEREA A CORTO PLAZO, POR LO QUE SE INFORMA AL\nPACIENTE. SE REPORTA PACIENTE GRAVE CON PRONOSTICO RESERVADO A EVOLUCION NO EXCENTO DE COMPLICACIONES.\n\nIMPRESIONES DIAGNOSTICAS:\n\n1.INFECCION DE VIAS RESPIRATORIAS BAJAS\n\nNEUMONIA ATIPICA. 6 PUNTOS DE NEWS 2 RIESGO MODERADO. Q SOFA 1 PUNTO, CASO SOSPECHOSO PARA COVID 19\n2. DIABETES TIPO 2 EN TRATAMIENTO\n\n3. HIPERTENSION ARTERIAL SISTEMICA EN TRATAMIENTO",
  "síntomas": {
    "fiebre": [
      {
        "mención": "...semana despues se agrego fiebre  cuantificada de 37 * c...",
        "wikidata": "https://www.wikidata.org/wiki/Q38933"
      }
    ],
    "disnea": [
      {
        "mención": "...y el olfato y disnea de medianos esfuerzos por...",
        "wikidata": "https://www.wikidata.org/wiki/Q188008"
      },
      {
        "mención": "...presenta aumento de la disnea motivo acude a esta...",
        "wikidata": "https://www.wikidata.org/wiki/Q188008"
      }
    ],
    "dificultad respiratoria": [
      {
        "mención": "...acompanante. motivo de ingreso: dificultad respiratoria.  antecedentes personales patologicos. enfermedades...",
        "wikidata": "https://www.wikidata.org/wiki/Q188008"
      },
      {
        "mención": "...de datos clinicos de dificultad respiratoria, por lo que se...",
        "wikidata": "https://www.wikidata.org/wiki/Q188008"
      }
    ]
  },
  "muestreos": [
    {
      "mención": "...solicitan y se  toman muestras para estudios de laboratorio..."
    }
  ]
}

```

se debe tener un directorio de uploads a donde van a cargarse los pdfs (cuidado con saturarlo) y un directorio log que está destinado a supervisar el servidor.


---

probando machine learning...

OpenNLP 1.9.2. 
amolina@Mac:~/repo/covidminer/mldata$cat minitrain.txt | wc -l
   58698

Algunos problemas

La carencia de factor intrínseco en la secreción gástrica ocasiona <START:Desease> anemia perniciosa <END> , acompañada en ocasiones de molestias abdominales vagas y episodios recurrentes de <START:Desease> diarrea <END> .
La carencia de factor intrínseco en la secreción gástrica ocasiona <START:Desease> anemia perniciosa <END>. acompañada en ocasiones de molestias abdominales vagas y episodios recurrentes de <START:Desease> diarrea <END> .


replace 
-<START:Desease>
- <START:Desease>


Un tipo frecuente de <START:Desease> neumonía <END> es la <START:Desease> <START:Desease> neumonía <END> bacteriana <END> , originada más frecuentemente por neumococos .
Cuando una neurona motora se pone enferma , como sucede en la <START:Desease> <START:Desease> atrofia muscular <END> progresiva <END> , puede manifestar una irritabilidad aumentada y todas las fibras musculares que ella controla pueden descargarse de manera esporádica , aisladamente y con independencia de otras unidades .
Por desgracia , los músculos proximales están ocasionalmente implicados en la <START:Desease> <START:Desease> atrofia muscular <END> espinal <END> progresiva , como en el síndrome descrito por primera vez por Wohlfart y otros , y por Kugelberg @ - @ Welander , lo que contribuye a hacer más confuso el diagnóstico .

--

amolina@Mac:~/repo/covidminer/mldata$opennlp TokenNameFinderTrainer -model es-covidmini.bin -lang es -data minitrain.txt -encoding UTF-8
Indexing events with TwoPass using cutoff of 0

  Computing event counts...  done. 1622122 events
  Indexing...  done.
Collecting events... Done indexing in 77.17 s.
Incorporating indexed data for training...  
done.
  Number of Event Tokens: 1622122
      Number of Outcomes: 4
    Number of Predicates: 1587261
Computing model parameters...
Performing 300 iterations.
  1:  . (1618012/1622122) 0.9974662818209727
  2:  . (1620490/1622122) 0.9989939104457002
  3:  . (1621177/1622122) 0.9994174297617565
  4:  . (1621423/1622122) 0.9995690829666326
  5:  . (1621605/1622122) 0.9996812816791832
  6:  . (1621758/1622122) 0.9997756025748988
  7:  . (1621815/1622122) 0.9998107417321261
  8:  . (1621828/1622122) 0.9998187559258798
  9:  . (1621853/1622122) 0.9998341678369445
 10:  . (1621935/1622122) 0.9998847189052364
Stopping: change in training set accuracy less than 1.0E-5
Stats: (1622026/1622122) 0.9999408182615118
...done.

Training data summary:
#Sentences: 58350
#Tokens: 1622122
#Desease entities: 6427
#Symptom entities: 248

Writing name finder model ... Compressed 1587261 parameters to 32587
11 outcome patterns
done (1.585s)

Wrote name finder model to
path: /Users/amolina/repo/covidminer/mldata/es-covidmini.bin

Execution time: 124.305 seconds


---

(venv) amolina@Mac:~/repo/covidminer$python scripts/tagcorpus.py /Users/amolina/repo/covidminer/mldata/IULACorpus  /Users/amolina/repo/covidminer/mldata/pretagged

(venv) amolina@Mac:~/repo/covidminer/mldata$for f in ./pretagged/*txt; do (cat "${f}"; echo) >> ./train_iulapretagged.txt; done


La que el enfermo considera <START:Desease> eyaculación precoz <END>. no
<END>\. ([a-zA-Z])
<END> \1

([a-zA-Z])\.<START
\1 <START


...

(venv) amolina@Mac:~/repo/covidminer/mldata$opennlp TokenNameFinderTrainer -model mx-med.bin -lang es -data train_iulapretagged.txt -encoding UTF-8 -params params.txt
Indexing events with TwoPass using cutoff of 4

  Computing event counts...  done. 5018453 events
  Indexing...  done.
Collecting events... Done indexing in 184.03 s.
Incorporating indexed data for training...  
done.
  Number of Event Tokens: 5018453
      Number of Outcomes: 7
    Number of Predicates: 725787
Computing model parameters...
Performing 100000 iterations.
  1:  . (5008180/5018453) 0.9979529548249232
  2:  . (5014227/5018453) 0.9991579078253796
  3:  . (5015538/5018453) 0.9994191437082304
  4:  . (5015992/5018453) 0.9995096098339469
  5:  . (5016312/5018453) 0.9995733745040554
  6:  . (5016579/5018453) 0.9996265781506771
  7:  . (5016729/5018453) 0.9996564678397905
  8:  . (5016909/5018453) 0.9996923354667265
  9:  . (5016995/5018453) 0.9997094722218182
 10:  . (5017074/5018453) 0.9997252141247512
 20:  . (5017479/5018453) 0.9998059162853573
Stopping: change in training set accuracy less than 1.0E-5
Stats: (5016506/5018453) 0.9996120318353086
...done.

Training data summary:
#Sentences: 182784
#Tokens: 5018453
#Drug entities: 508
#Desease entities: 20488
#Symptom entities: 4805

Writing name finder model ... Compressed 725787 parameters to 56711
77 outcome patterns
done (1.714s)

Wrote name finder model to
path: /Users/amolina/repo/covidminer/mldata/mx-med.bin

Execution time: 330.671 seconds



---

(venv) amolina@Mac:~/repo/covidminer/mldata$opennlp TokenNameFinderTrainer -model mx-med2.bin -lang es -data train_iulapretagged.txt -encoding UTF-8 -params params.txt
Indexing events with TwoPass using cutoff of 3

  Computing event counts...  done. 5018453 events
  Indexing...  done.
Collecting events... Done indexing in 176.57 s.
Incorporating indexed data for training...  
done.
  Number of Event Tokens: 5018453
      Number of Outcomes: 7
    Number of Predicates: 930452
Computing model parameters...
Performing 150000 iterations.
  1:  . (5008230/5018453) 0.9979629180546276
  2:  . (5014500/5018453) 0.999212307059566
  3:  . (5015674/5018453) 0.9994462436930265
  4:  . (5016273/5018453) 0.9995656031848859
  5:  . (5016606/5018453) 0.9996319582947175
  6:  . (5016846/5018453) 0.9996797817972989
  7:  . (5017016/5018453) 0.999713656778294
  8:  . (5017192/5018453) 0.9997487273468537
  9:  . (5017269/5018453) 0.9997640707205986
 10:  . (5017338/5018453) 0.9997778199775907
 20:  . (5017684/5018453) 0.9998467655271455
Stopping: change in training set accuracy less than 1.0E-5
Stats: (5017750/5018453) 0.9998599169903554
...done.

Training data summary:
#Sentences: 182784
#Tokens: 5018453
#Drug entities: 508
#Desease entities: 20488
#Symptom entities: 4805

Writing name finder model ... Compressed 930452 parameters to 56995
69 outcome patterns
done (1.911s)

Wrote name finder model to
path: /Users/amolina/repo/covidminer/mldata/mx-med2.bin

Execution time: 350.571 seconds

